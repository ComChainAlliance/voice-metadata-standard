{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "http://finos.org/schemas/callmetadata.json",
    "title": "Call Metadata Standard",
    "description": "Meta data supporting dialtone, ringdown, and shoutdown calls",
    "type": "object",
    "definitions": {
        "states": {
            "type": "object",
            "properties": {
                "state": {
                    "type": "string",
                    "description": "name of the latest state of the current communication: CallOriginated, CallDelivered, CallEstablished, ect. Could be an enum with defined states. ",
                    "example": "CallDelivered"
                },
                "time": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Date and time when the state changed for the given participant",
                    "example": "2016-06-18T08:05:15Z"
                },
                "duration": {
                    "type": "integer",
                    "description": "Time in milliseconds how of how long the call has been in previous states for the given participant",
                    "example": 27978
                }
            }
        },
        "member": {
            "name": {
                "type": "string",
                "example": "Steve Jones",
                "description": "Name of the participant communicating as defined in schema.org"
            },
            "groupName": {
                "type": "string",
                "example": "Energy Desk",
                "description": "Name of the group for which the participant is representing in the communication"
            },
            "firmName": {
                "type": "string",
                "example": "XYZ Firm",
                "description": "Name of the participant's firm represnted in the communication"
            },
            "timeZoneOffset": {
                "type": "string",
                "example": "UTC -05:00:00",
                "description": "The UTC timezone offset for the participant"
            }
        },
        "participant": {
            "type": "object",
            "description": "Specific details about a participant in a given communication",
            "properties": {
                "member": {
                    "$ref": "#/definitions/member"
                },
                "involvement": {
                    "type": "string",
                    "description": "How the participant joined the communication. Did they initiate it, receieve a request or join an ongoing communication?",
                    "enum": [
                        "source",
                        "destination",
                        "participant"
                    ]
                },
                "address": {
                    "type": "string",
                    "example": "sip:9991234567@voip-provider.net",
                    "description": "The address of the participant. It can be a URL, a username or any other type of address used to reach this participant."
                },
                "joinTime": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2016-06-18T07:50:30Z",
                    "description": "Date and time when the participant joined the conversation"
                },
                "exitTime": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2016-06-18T08:15:15Z",
                    "description": "Date and time when the participant exited the conversation"
                },
                "states": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/states"
                    }
                }
            }
        }
    },
    "properties": {
        "deviceInfo": {
            "type": "object",
            "description": "Information about the device that generated this call record",
            "properties": {
                "deviceID": {
                    "type": "string",
                    "description": "Identifier for the device",
                    "example": "turret1"
                }
            }
        },
        "recordingFile": {
            "type": "object",
            "description": "Information about the recording associated with the call record",
            "properties": {
                "fileName": {
                    "type": "string",
                    "example": "sPK-20160517-163415-johnsmith-1165020038-1.m4a",
                    "description": "The name of the recording file as stored"
                },
                "checksum": {
                    "type": "object",
                    "description": "Checksum of the recording file used to verify the file integrity. The hash values are compared and, if they match, confirms that the data has not been altered. It can be stored in one of the supported algorithms listed in type enum",
                    "required": [
                        "hash"
                    ],
                    "properties": {
                        "type": {
                            "type": "string",
                            "description": "Hash algorithm used on recording checksum.",
                            "default": "MD5",
                            "enum": [
                                "MD5",
                                "SHA-256",
                                "SHA-384",
                                "SHA-512",
                                "SHA3-224",
                                "SHA3-256",
                                "SHA3-384",
                                "SHA3-512"
                            ]
                        },
                        "hash": {
                            "type": "string",
                            "example": "ca834d692f1d2ae659c69b72372c39a0",
                            "description": "Checksum of the recording file in the selected hash type"
                        }
                    }
                }
            }
        },
        "communicationRecord": {
            "type": "object",
            "properties": {
                "callRecordType": {
                    "type": "string",
                    "enum": [
                        "Shoutdown",
                        "Ringdown",
                        "Dialtone"
                    ],
                    "description": "The type of call that was made (dialtone, ringdown, shoutdown, etc)"
                },
                "callUUID": {
                    "type": "string",
                    "example": "fd5cee0fe0184142a4397c92cb71f73620170508224148",
                    "description": "Universally Unique Identifier for this call. Will be unique across all call records."
                },
                "recordingStartTime": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Start date and time of the recording in ISO 8601 UTC time format",
                    "example": "2016-06-18T07:50:30Z"
                },
                "callDirection": {
                    "type": "string",
                    "enum": [
                        "outgoing",
                        "incoming"
                    ],
                    "description": "Direction of call establishment",
                    "example": "outgoing"
                }
            }
        }
    }
}
